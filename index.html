<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#0f0f1a">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>üçΩÔ∏è Omar's Recovery Kitchen</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    :root {
      --bg-primary: #0a0a12;
      --bg-secondary: #12121e;
      --bg-card: rgba(255,255,255,0.03);
      --gold: #d4af37;
      --gold-light: #f0d878;
      --text-primary: #f5f5f5;
      --text-secondary: #a0a0b0;
      --appetizer: #7dd3c0;
      --main: #f87171;
      --dessert: #f9a8d4;
      --special: #fcd34d;
      --rescue: #fb923c;
      --success: #22c55e;
      --error: #ef4444;
    }
    
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      min-height: 100vh;
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
    }
    
    .container {
      max-width: 600px;
      margin: 0 auto;
      padding: 0;
    }
    
    /* Hero Section */
    header {
      text-align: center;
      padding: 60px 24px 40px;
      background: linear-gradient(180deg, var(--bg-secondary) 0%, var(--bg-primary) 100%);
      position: relative;
      overflow: hidden;
    }
    
    header::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(ellipse at center, rgba(212,175,55,0.08) 0%, transparent 60%);
      animation: pulse 8s ease-in-out infinite;
    }
    
    @keyframes pulse {
      0%, 100% { transform: scale(1); opacity: 0.5; }
      50% { transform: scale(1.1); opacity: 0.8; }
    }
    
    .header-content {
      position: relative;
      z-index: 1;
    }
    
    .plate-icon {
      font-size: 4rem;
      margin-bottom: 16px;
      display: block;
      animation: float 3s ease-in-out infinite;
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-8px); }
    }
    
    header h1 {
      font-family: 'Playfair Display', Georgia, serif;
      font-size: 2rem;
      font-weight: 700;
      color: var(--gold);
      margin-bottom: 12px;
      letter-spacing: -0.02em;
    }
    
    .tagline {
      font-style: italic;
      color: var(--text-secondary);
      font-size: 1rem;
      margin-bottom: 20px;
    }
    
    .instruction-card {
      background: rgba(212,175,55,0.1);
      border: 1px solid rgba(212,175,55,0.2);
      border-radius: 12px;
      padding: 16px;
      margin-top: 20px;
    }
    
    .instruction-card p {
      font-size: 0.9rem;
      color: var(--text-secondary);
      line-height: 1.5;
    }
    
    .instruction-card strong {
      color: var(--gold-light);
    }

    /* Setup Required / Token Entry Modal */
    .setup-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(10,10,18,0.95);
      z-index: 2000;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
      backdrop-filter: blur(10px);
    }

    .setup-overlay.hidden {
      display: none;
    }

    .setup-modal {
      background: var(--bg-secondary);
      border-radius: 20px;
      padding: 32px 24px;
      max-width: 480px;
      width: 100%;
      border: 1px solid rgba(212,175,55,0.2);
      text-align: center;
    }

    .setup-modal h2 {
      font-family: 'Playfair Display', Georgia, serif;
      color: var(--gold);
      font-size: 1.5rem;
      margin-bottom: 16px;
    }

    .setup-modal p {
      color: var(--text-secondary);
      font-size: 0.95rem;
      margin-bottom: 20px;
      line-height: 1.6;
    }

    .setup-modal ol {
      text-align: left;
      color: var(--text-secondary);
      font-size: 0.9rem;
      margin: 20px 0;
      padding-left: 24px;
    }

    .setup-modal li {
      margin-bottom: 8px;
    }

    .setup-modal code {
      background: rgba(255,255,255,0.1);
      padding: 2px 6px;
      border-radius: 4px;
      font-family: monospace;
      font-size: 0.85rem;
      color: var(--gold-light);
    }

    .setup-input {
      width: 100%;
      padding: 14px 16px;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 12px;
      color: var(--text-primary);
      font-family: 'Inter', monospace;
      font-size: 0.9rem;
      margin-bottom: 16px;
    }

    .setup-input::placeholder {
      color: var(--text-secondary);
    }

    .setup-input:focus {
      outline: none;
      border-color: var(--gold);
    }

    .setup-btn {
      background: linear-gradient(135deg, var(--gold) 0%, var(--gold-light) 100%);
      color: var(--bg-primary);
      border: none;
      padding: 14px 32px;
      font-size: 1rem;
      font-weight: 600;
      border-radius: 50px;
      cursor: pointer;
      transition: transform 0.2s ease;
      -webkit-tap-highlight-color: transparent;
    }

    .setup-btn:active {
      transform: scale(0.98);
    }

    .security-warning {
      background: rgba(239,68,68,0.1);
      border: 1px solid rgba(239,68,68,0.2);
      border-radius: 12px;
      padding: 16px;
      margin-top: 20px;
      text-align: left;
    }

    .security-warning h4 {
      color: #f87171;
      font-size: 0.9rem;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .security-warning p {
      font-size: 0.85rem;
      margin: 0;
      color: var(--text-secondary);
    }

    .security-warning ul {
      margin-top: 8px;
      padding-left: 20px;
      color: var(--text-secondary);
      font-size: 0.85rem;
    }

    .security-warning li {
      margin-bottom: 4px;
    }

    /* Config Section */
    .config-section {
      margin: 16px 16px 24px;
      padding: 16px;
      background: var(--bg-secondary);
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,0.05);
    }

    .config-section h3 {
      font-size: 0.9rem;
      color: var(--gold);
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .config-input {
      width: 100%;
      padding: 12px 16px;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 10px;
      color: var(--text-primary);
      font-family: 'Inter', monospace;
      font-size: 0.85rem;
      margin-bottom: 8px;
    }

    .config-input::placeholder {
      color: var(--text-secondary);
    }

    .config-input:focus {
      outline: none;
      border-color: var(--gold);
    }

    .config-status {
      font-size: 0.8rem;
      padding: 8px 12px;
      border-radius: 8px;
      margin-top: 8px;
      display: none;
    }

    .config-status.show {
      display: block;
    }

    .config-status.success {
      background: rgba(34,197,94,0.1);
      color: var(--success);
      border: 1px solid rgba(34,197,94,0.2);
    }

    .config-status.error {
      background: rgba(239,68,68,0.1);
      color: var(--error);
      border: 1px solid rgba(239,68,68,0.2);
    }

    .config-status.pending {
      background: rgba(212,175,55,0.1);
      color: var(--gold);
      border: 1px solid rgba(212,175,55,0.2);
    }

    .token-source-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 0.75rem;
      padding: 4px 10px;
      border-radius: 20px;
      margin-bottom: 12px;
    }

    .token-source-badge.url {
      background: rgba(34,197,94,0.15);
      color: var(--success);
      border: 1px solid rgba(34,197,94,0.3);
    }

    .token-source-badge.storage {
      background: rgba(212,175,55,0.15);
      color: var(--gold);
      border: 1px solid rgba(212,175,55,0.3);
    }

    .token-source-badge.manual {
      background: rgba(96,165,250,0.15);
      color: #60a5fa;
      border: 1px solid rgba(96,165,250,0.3);
    }

    .url-bookmark-help {
      background: rgba(34,197,94,0.1);
      border: 1px solid rgba(34,197,94,0.2);
      border-radius: 10px;
      padding: 12px;
      margin-top: 12px;
      font-size: 0.85rem;
    }

    .url-bookmark-help h4 {
      color: var(--success);
      font-size: 0.85rem;
      margin-bottom: 8px;
    }

    .url-bookmark-help p {
      color: var(--text-secondary);
      margin: 0;
      font-size: 0.8rem;
      line-height: 1.5;
    }

    .url-bookmark-help code {
      background: rgba(255,255,255,0.1);
      padding: 2px 6px;
      border-radius: 4px;
      font-family: monospace;
      color: var(--gold-light);
      word-break: break-all;
    }

    .config-section details {
      margin-top: 12px;
      font-size: 0.8rem;
      color: var(--text-secondary);
    }

    .config-section summary {
      cursor: pointer;
      color: var(--gold);
    }

    .config-section details ul {
      margin-top: 8px;
      padding-left: 20px;
    }

    .config-section details li {
      margin-bottom: 4px;
    }

    .config-section code {
      background: rgba(255,255,255,0.1);
      padding: 2px 6px;
      border-radius: 4px;
      font-family: monospace;
    }
    
    /* Toast Notifications */
    .toast-container {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 1000;
      display: flex;
      flex-direction: column;
      gap: 8px;
      width: 90%;
      max-width: 400px;
    }

    .toast {
      padding: 12px 16px;
      border-radius: 12px;
      font-size: 0.9rem;
      font-weight: 500;
      animation: slideUp 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
    }

    .toast.success {
      background: rgba(34,197,94,0.95);
      color: #fff;
    }

    .toast.error {
      background: rgba(239,68,68,0.95);
      color: #fff;
    }

    .toast.info {
      background: rgba(212,175,55,0.95);
      color: #000;
    }

    @keyframes slideUp {
      from { opacity: 0; transform: translateY(20px) translateX(-50%); }
      to { opacity: 1; transform: translateY(0) translateX(-50%); }
    }
    
    /* Menu Sections */
    .menu-section {
      margin: 8px 16px 24px;
      border-radius: 20px;
      background: var(--bg-secondary);
      overflow: hidden;
      border: 1px solid rgba(255,255,255,0.05);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    
    .menu-section:active {
      transform: scale(0.995);
    }
    
    .section-header {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 20px;
      cursor: pointer;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
      transition: background 0.2s ease;
    }
    
    .section-header:active {
      background: rgba(255,255,255,0.02);
    }
    
    .section-icon {
      font-size: 2.5rem;
      width: 56px;
      height: 56px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 16px;
      background: rgba(255,255,255,0.05);
    }
    
    .appetizers .section-icon { background: rgba(125,211,192,0.15); }
    .mains .section-icon { background: rgba(248,113,113,0.15); }
    .desserts .section-icon { background: rgba(249,168,212,0.15); }
    .specials .section-icon { background: rgba(252,211,77,0.15); }
    .rescue .section-icon { background: rgba(251,146,60,0.15); }
    
    .section-title {
      flex: 1;
    }
    
    .section-title h2 {
      font-family: 'Playfair Display', Georgia, serif;
      font-size: 1.3rem;
      font-weight: 600;
      margin-bottom: 4px;
    }
    
    .appetizers .section-title h2 { color: var(--appetizer); }
    .mains .section-title h2 { color: var(--main); }
    .desserts .section-title h2 { color: var(--dessert); }
    .specials .section-title h2 { color: var(--special); }
    .rescue .section-title h2 { color: var(--rescue); }
    
    .section-title p {
      color: var(--text-secondary);
      font-size: 0.85rem;
    }
    
    .chevron {
      font-size: 1.2rem;
      color: var(--text-secondary);
      transition: transform 0.3s ease;
    }
    
    .menu-section.expanded .chevron {
      transform: rotate(180deg);
    }
    
    .section-content {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.4s ease-out;
    }
    
    .menu-section.expanded .section-content {
      max-height: 2000px;
    }
    
    .items-container {
      padding: 0 16px 16px;
    }
    
    /* Menu Items */
    .menu-item {
      display: flex;
      gap: 14px;
      padding: 16px;
      margin: 8px 0;
      background: var(--bg-card);
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.03);
      transition: all 0.2s ease;
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
      position: relative;
    }

    .menu-item.sending {
      opacity: 0.7;
      pointer-events: none;
    }

    .menu-item.sending::after {
      content: 'üìù';
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      animation: pulse-emoji 1s ease-in-out infinite;
    }

    .menu-item.tracked::after {
      content: '‚úÖ';
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
    }

    @keyframes pulse-emoji {
      0%, 100% { opacity: 0.5; }
      50% { opacity: 1; }
    }
    
    .menu-item:active {
      transform: scale(0.98);
      background: rgba(255,255,255,0.06);
    }
    
    .menu-item.selected {
      background: rgba(212,175,55,0.1);
      border-color: rgba(212,175,55,0.3);
    }
    
    .item-emoji {
      font-size: 1.8rem;
      min-width: 44px;
      height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(255,255,255,0.05);
      border-radius: 12px;
    }
    
    .item-content {
      flex: 1;
    }
    
    .item-content h3 {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 4px;
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
      padding-right: 28px;
    }
    
    .item-tagline {
      color: var(--gold);
      font-size: 0.8rem;
      font-weight: 500;
      font-style: italic;
    }
    
    .item-content p {
      color: var(--text-secondary);
      font-size: 0.9rem;
      line-height: 1.5;
    }
    
    .desserts .item-content h3 {
      color: var(--dessert);
    }
    
    .warning {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      color: #f87171;
      font-weight: 600;
      font-size: 0.8rem;
      margin-top: 8px;
      padding: 6px 10px;
      background: rgba(248,113,113,0.1);
      border-radius: 8px;
    }

    /* Suggestions Integration Styles */
    .suggestions {
      margin-top: 12px;
      padding: 12px;
      background: rgba(212, 175, 55, 0.05);
      border: 1px solid rgba(212, 175, 55, 0.15);
      border-radius: 10px;
    }

    .suggestion-header {
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--gold);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 8px;
    }

    .suggestion-list {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .suggestion-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 10px;
      background: rgba(255, 255, 255, 0.03);
      border-radius: 8px;
      text-decoration: none;
      transition: all 0.2s ease;
      border: 1px solid transparent;
    }

    .suggestion-item:hover {
      background: rgba(255, 255, 255, 0.06);
      border-color: rgba(212, 175, 55, 0.3);
    }

    .suggestion-item.urgent {
      background: rgba(239, 68, 68, 0.08);
      border-color: rgba(239, 68, 68, 0.2);
    }

    .suggestion-item.urgent:hover {
      background: rgba(239, 68, 68, 0.12);
      border-color: rgba(239, 68, 68, 0.4);
    }

    .suggestion-item.low {
      opacity: 0.8;
    }

    .suggestion-item.dream {
      background: rgba(147, 51, 234, 0.08);
      border-color: rgba(147, 51, 234, 0.2);
    }

    .suggestion-emoji {
      font-size: 1rem;
      min-width: 20px;
      text-align: center;
    }

    .suggestion-name {
      font-size: 0.85rem;
      font-weight: 500;
      color: var(--text-primary);
    }

    .suggestion-time {
      font-size: 0.75rem;
      color: var(--text-secondary);
      background: rgba(255, 255, 255, 0.08);
      padding: 2px 6px;
      border-radius: 4px;
      margin-left: auto;
    }

    .suggestion-meta {
      font-size: 0.75rem;
      color: var(--text-secondary);
      font-style: italic;
    }

    /* Project-specific styling */
    .project-suggestions .suggestion-item.urgent .suggestion-name {
      color: #f87171;
      font-weight: 600;
    }

    .chore-suggestions .suggestion-time {
      font-family: 'Inter', monospace;
      font-size: 0.7rem;
    }

    /* Walk suggestions - horizontal layout on larger screens */
    @media (min-width: 400px) {
      .walk-suggestions .suggestion-list {
        flex-direction: row;
        flex-wrap: wrap;
      }
      
      .walk-suggestions .suggestion-item {
        flex: 1;
        min-width: 140px;
      }
    }
    
    .check-indicator {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      border: 2px solid rgba(255,255,255,0.2);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8rem;
      color: transparent;
      transition: all 0.2s ease;
      flex-shrink: 0;
    }
    
    .menu-item.selected .check-indicator {
      background: var(--gold);
      border-color: var(--gold);
      color: var(--bg-primary);
    }
    
    /* Random Picker Button */
    .picker-section {
      padding: 24px 16px;
      text-align: center;
    }
    
    .random-btn {
      background: linear-gradient(135deg, var(--gold) 0%, var(--gold-light) 100%);
      color: var(--bg-primary);
      border: none;
      padding: 16px 32px;
      font-size: 1rem;
      font-weight: 600;
      border-radius: 50px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 10px;
      box-shadow: 0 4px 20px rgba(212,175,55,0.3);
      transition: all 0.2s ease;
      -webkit-tap-highlight-color: transparent;
    }
    
    .random-btn:active {
      transform: scale(0.95);
      box-shadow: 0 2px 10px rgba(212,175,55,0.2);
    }
    
    .result-card {
      margin-top: 20px;
      padding: 20px;
      background: var(--bg-secondary);
      border-radius: 16px;
      border: 1px solid rgba(212,175,55,0.2);
      display: none;
      animation: slideUpResult 0.3s ease;
    }
    
    .result-card.show {
      display: block;
    }
    
    @keyframes slideUpResult {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .result-emoji {
      font-size: 3rem;
      margin-bottom: 8px;
    }
    
    .result-title {
      font-family: 'Playfair Display', serif;
      font-size: 1.3rem;
      color: var(--gold);
      margin-bottom: 8px;
    }
    
    .result-desc {
      color: var(--text-secondary);
      font-size: 0.95rem;
    }
    
    /* Footer */
    footer {
      text-align: center;
      padding: 40px 24px;
      color: var(--text-secondary);
    }
    
    footer p {
      font-size: 0.9rem;
      margin-bottom: 8px;
    }
    
    .footer-quote {
      font-style: italic;
      color: var(--gold);
      font-size: 1rem;
    }
    
    /* Progress indicator */
    .progress-bar {
      position: fixed;
      top: 0;
      left: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--gold), var(--gold-light));
      width: 0%;
      transition: width 0.3s ease;
      z-index: 100;
    }
    
    /* Responsive adjustments */
    @media (min-width: 600px) {
      header { padding: 80px 24px 50px; }
      header h1 { font-size: 2.5rem; }
      .menu-section { margin: 12px 24px 32px; }
      .config-section { margin: 16px 24px 24px; }
    }
    
    /* Accessibility */
    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after {
        animation-duration: 0.01ms !important;
        transition-duration: 0.01ms !important;
      }
    }
  </style>
</head>
<body>
  <div class="progress-bar" id="progressBar"></div>
  
  <div class="toast-container" id="toastContainer"></div>
  
  <!-- Setup Required Modal (shown when no token) -->
  <div class="setup-overlay hidden" id="setupOverlay">
    <div class="setup-modal">
      <h2>üîê Setup Required</h2>
      <p>To track your menu picks across devices, you need to authenticate with a GitHub Personal Access Token.</p>
      
      <ol>
        <li>Go to GitHub ‚Üí Settings ‚Üí Developer settings ‚Üí <strong>Personal access tokens ‚Üí Fine-grained tokens</strong></li>
        <li>Generate a new token with access to your <code>recovery-kitchen</code> repo</li>
        <li>Set <strong>Contents</strong> permission to <code>Read and write</code></li>
        <li>Copy your token (starts with <code>ghp_</code>)</li>
      </ol>
      
      <input type="password" class="setup-input" id="setupTokenInput" placeholder="Paste your GitHub token here (ghp_...)">
      <button class="setup-btn" onclick="saveTokenFromSetup()">Save & Continue</button>
      
      <div class="security-warning">
        <h4>‚ö†Ô∏è Security Notice</h4>
        <p>For easier multi-device setup, you can bookmark this URL with your token:</p>
        <code style="display: block; margin: 8px 0; word-break: break-all; font-size: 0.75rem;">https://omarclaw1420.github.io/recovery-kitchen/?token=ghp_YOUR_TOKEN</code>
        <ul>
          <li>‚ö†Ô∏è <strong>Never share this bookmarked URL</strong> ‚Äî it contains your token</li>
          <li>‚ö†Ô∏è Token will be visible in browser history and potentially screenshots</li>
          <li>‚úÖ Use a fine-grained PAT with minimal permissions (contents: read+write only)</li>
          <li>‚úÖ Token is automatically removed from visible URL after loading</li>
          <li>‚úÖ If compromised, revoke the token in GitHub and generate a new one</li>
        </ul>
      </div>
    </div>
  </div>

  <div class="container" id="appContainer">
    <header>
      <div class="header-content">
        <span class="plate-icon">üçΩÔ∏è</span>
        <h1>Omar's Recovery Kitchen</h1>
        <p class="tagline">A menu for when you're stuck, scrolling, or just... blah.</p>
        <div class="instruction-card">
          <p><strong>How to use:</strong> Pick anything. Seriously. The goal isn't perfection ‚Äî it's movement. Even a bad choice beats no choice. Tap items to track your activity!</p>
        </div>
      </div>
    </header>

    <!-- Configuration Section -->
    <div class="config-section">
      <h3>üîê GitHub Tracking Setup</h3>
      <div id="tokenSourceBadge"></div>
      <input type="password" class="config-input" id="githubToken" placeholder="Paste your GitHub fine-grained PAT here" oninput="saveToken()">
      <input type="text" class="config-input" id="repoOwner" placeholder="Repository owner (default: omarclaw1420)" oninput="saveToken()">
      <input type="text" class="config-input" id="repoName" placeholder="Repository name (default: recovery-kitchen)" oninput="saveToken()">
      <div class="config-status" id="configStatus"></div>
      
      <div class="url-bookmark-help" id="urlBookmarkHelp" style="display: none;">
        <h4>üîó URL-Based Setup (Recommended for Multi-Device)</h4>
        <p>Create a bookmark with your token in the URL for instant setup on new devices:</p>
        <code id="bookmarkUrlExample"></code>
        <p style="margin-top: 8px;">‚ö†Ô∏è <strong>Keep this URL private</strong> ‚Äî it contains your authentication token.</p>
      </div>
      
      <details>
        <summary>How to set up tracking</summary>
        <ul>
          <li>Go to GitHub ‚Üí Settings ‚Üí Developer settings ‚Üí Personal access tokens ‚Üí <strong>Fine-grained tokens</strong></li>
          <li>Click "Generate new token"</li>
          <li>Set <strong>Repository access</strong> to your <code>recovery-kitchen</code> repo only</li>
          <li>Set <strong>Permissions</strong> ‚Üí <strong>Contents</strong> ‚Üí <code>Read and write</code></li>
          <li>Also set <strong>Metadata</strong> ‚Üí <code>Read</code> (required)</li>
          <li>Generate and copy the token here</li>
          <li><strong>Important:</strong> The <code>data/menu-log.json</code> file will be created automatically on first use</li>
        </ul>
      </details>
      
      <details style="margin-top: 8px;">
        <summary>üîí Security & Privacy</summary>
        <ul>
          <li>Your token is stored only in your browser's localStorage (never on our servers)</li>
          <li>When using URL-based setup, the token is automatically removed from the visible URL after loading</li>
          <li>However, the original URL with token remains in browser history</li>
          <li>Use a fine-grained PAT limited to just this repository</li>
          <li>If you share screenshots, make sure the URL bar isn't visible</li>
          <li>Rotate your token periodically (every 90 days recommended)</li>
        </ul>
      </details>
    </div>

    <!-- Random Picker -->
    <div class="picker-section">
      <button class="random-btn" onclick="pickRandom()">
        üé≤ Surprise Me
      </button>
      <div class="result-card" id="resultCard">
        <div class="result-emoji" id="resultEmoji">üéØ</div>
        <div class="result-title" id="resultTitle">Your Pick</div>
        <div class="result-desc" id="resultDesc">Description here</div>
      </div>
    </div>

    <!-- APPETIZERS -->
    <section class="menu-section appetizers expanded" data-section="appetizers" data-category="Appetizer">
      <div class="section-header" onclick="toggleSection(this)">
        <span class="section-icon">ü•ó</span>
        <div class="section-title">
          <h2>Appetizers</h2>
          <p>Light bites to wake you up (5‚Äì15 min)</p>
        </div>
        <span class="chevron">‚ñº</span>
      </div>
      <div class="section-content">
        <div class="items-container">
          <div class="menu-item" onclick="trackActivity(this, 'Small Walk')" data-emoji="üö∂">
            <span class="check-indicator">‚úì</span>
            <span class="item-emoji">üö∂</span>
            <div class="item-content">
              <h3>Small Walk <span class="item-tagline">‚Äî The Reset Button</span></h3>
              <p>Step outside. No destination needed. 5 minutes of fresh air untangles your brain. Your back will thank you.</p>
              <div class="suggestions walk-suggestions">
                <div class="suggestion-header">üéØ Combine with errands:</div>
                <div class="suggestion-list">
                  <span class="suggestion-item">
                    <span class="suggestion-emoji">üëï</span>
                    <span class="suggestion-name">Get laundry</span>
                    <span class="suggestion-time">15-30 min</span>
                  </span>
                  <span class="suggestion-item">
                    <span class="suggestion-emoji">üìÖ</span>
                    <span class="suggestion-name">Book annual check</span>
                    <span class="suggestion-time">5-10 min</span>
                  </span>
                </div>
              </div>
            </div>
          </div>
          
          <div class="menu-item" onclick="trackActivity(this, 'Organize Your Lab')" data-emoji="üßπ">
            <span class="check-indicator">‚úì</span>
            <span class="item-emoji">üßπ</span>
            <div class="item-content">
              <h3>Organize Your Lab <span class="item-tagline">‚Äî Tangible Progress</span></h3>
              <p>Move one thing to its place. Just one. Suddenly the chaos feels beatable.</p>
              <div class="suggestions lab-suggestions">
                <div class="suggestion-header">üí° Perfect for:</div>
                <div class="suggestion-list">
                  <span class="suggestion-item urgent">
                    <span class="suggestion-emoji">üî•</span>
                    <span class="suggestion-name">PlantPro</span>
                    <span class="suggestion-meta">‚Äî prep area for device testing</span>
                  </span>
                  <span class="suggestion-item">
                    <span class="suggestion-emoji">üöó</span>
                    <span class="suggestion-name">Change oil</span>
                    <span class="suggestion-meta">‚Äî garage/lab space prep</span>
                  </span>
                </div>
              </div>
            </div>
          </div>
          
          <div class="menu-item" onclick="trackActivity(this, 'Morning Milk / Evening Tea')" data-emoji="‚òï">
            <span class="check-indicator">‚úì</span>
            <span class="item-emoji">‚òï</span>
            <div class="item-content">
              <h3>Morning Milk / Evening Tea <span class="item-tagline">‚Äî The Ritual</span></h3>
              <p>Warmth in a cup. Morning = fuel. Night = wind-down. Either way, you're caring for yourself.</p>
            </div>
          </div>
          
          <div class="menu-item" onclick="trackActivity(this, 'Morning Exercises')" data-emoji="ü§∏">
            <span class="check-indicator">‚úì</span>
            <span class="item-emoji">ü§∏</span>
            <div class="item-content">
              <h3>Morning Exercises <span class="item-tagline">‚Äî Wake the Body</span></h3>
              <p>10 jumping jacks. A stretch. Your blood remembers how to move ‚Äî remind it.</p>
            </div>
          </div>
          
          <div class="menu-item" onclick="trackActivity(this, 'Quick Shower')" data-emoji="üöø">
            <span class="check-indicator">‚úì</span>
            <span class="item-emoji">üöø</span>
            <div class="item-content">
              <h3>Quick Shower <span class="item-tagline">‚Äî The Hard Reset</span></h3>
              <p>Water washes away more than dirt. Step in stale, step out new.</p>
            </div>
          </div>
          
          <div class="menu-item" onclick="trackActivity(this, 'Make Your Bed')" data-emoji="üõèÔ∏è">
            <span class="check-indicator">‚úì</span>
            <span class="item-emoji">üõèÔ∏è</span>
            <div class="item-content">
              <h3>Make Your Bed <span class="item-tagline">‚Äî 2-Minute Victory</span></h3>
              <p>The room instantly looks 40% better. You've already won today.</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- MAIN COURSES -->
    <section class="menu-section mains" data-section="mains" data-category="Main">
      <div class="section-header" onclick="toggleSection(this)">
        <span class="section-icon">üçñ</span>
        <div class="section-title">
          <h2>Main Courses</h2>
          <p>The "I actually did something" meals (30+ min)</p>
        </div>
        <span class="chevron">‚ñº</span>
      </div>
      <div class="section-content">
        <div class="items-container">
          <div class="menu-item" onclick="trackActivity(this, 'Work on a Project')" data-emoji="üõ†Ô∏è">
            <span class="check-indicator">‚úì</span>
            <span class="item-emoji">üõ†Ô∏è</span>
            <div class="item-content">
              <h3>Work on a Project <span class="item-tagline">‚Äî Build the Future</span></h3>
              <p>That thing you keep thinking about? 30 minutes on it. Future-you will be grateful.</p>
              <div class="suggestions project-suggestions">
                <div class="suggestion-header">üéØ Active Projects:</div>
                <div class="suggestion-list">
                  <span class="suggestion-item urgent">
                    <span class="suggestion-emoji">üî•</span>
                    <span class="suggestion-name">PlantPro</span>
                    <span class="suggestion-meta">‚Äî milestone today, testing phase</span>
                  </span>
                  <span class="suggestion-item low">
                    <span class="suggestion-emoji">üí°</span>
                    <span class="suggestion-name">Smart Switch</span>
                    <span class="suggestion-meta">‚Äî simple, low priority</span>
                  </span>
                  <span class="suggestion-item medium">
                    <span class="suggestion-emoji">üìç</span>
                    <span class="suggestion-name">Car/Bag Tracker</span>
                    <span class="suggestion-meta">‚Äî medium priority</span>
                  </span>
                  <span class="suggestion-item dream">
                    <span class="suggestion-emoji">ü§ñ</span>
                    <span class="suggestion-name">Little Assistant</span>
                    <span class="suggestion-meta">‚Äî dream project</span>
                  </span>
                </div>
              </div>
            </div>
          </div>
          
          <div class="menu-item" onclick="trackActivity(this, 'Learn Something New')" data-emoji="üìö">
            <span class="check-indicator">‚úì</span>
            <span class="item-emoji">üìö</span>
            <div class="item-content">
              <h3>Learn Something New <span class="item-tagline">‚Äî Expand</span></h3>
              <p>A chapter. A tutorial. A video that teaches instead of entertains. You grow when you learn.</p>
            </div>
          </div>
          
          <div class="menu-item" onclick="trackActivity(this, 'Crush Pending Chores')" data-emoji="‚úÖ">
            <span class="check-indicator">‚úì</span>
            <span class="item-emoji">‚úÖ</span>
            <div class="item-content">
              <h3>Crush Pending Chores <span class="item-tagline">‚Äî Clear the Decks</span></h3>
              <p>That list weighing on you? Pick three. Do them. The relief is instant.</p>
              <div class="suggestions chore-suggestions">
                <div class="suggestion-header">üìã Pending Chores:</div>
                <div class="suggestion-list">
                  <span class="suggestion-item">
                    <span class="suggestion-emoji">üöó</span>
                    <span class="suggestion-name">Change oil</span>
                    <span class="suggestion-time">30-60 min</span>
                  </span>
                  <span class="suggestion-item">
                    <span class="suggestion-emoji">ü™í</span>
                    <span class="suggestion-name">Shave</span>
                    <span class="suggestion-time">10-15 min</span>
                  </span>
                  <span class="suggestion-item">
                    <span class="suggestion-emoji">üìÖ</span>
                    <span class="suggestion-name">Book annual check for Cherokee</span>
                    <span class="suggestion-time">5-10 min</span>
                  </span>
                  <span class="suggestion-item">
                    <span class="suggestion-emoji">üëï</span>
                    <span class="suggestion-name">Get laundry</span>
                    <span class="suggestion-time">15-30 min</span>
                  </span>
                </div>
              </div>
            </div>
          </div>
          
          <div class="menu-item" onclick="trackActivity(this, 'Finish Something')" data-emoji="üèÜ">
            <span class="check-indicator">‚úì</span>
            <span class="item-emoji">üèÜ</span>
            <div class="item-content">
              <h3>Finish Something <span class="item-tagline">‚Äî The Closure</span></h3>
              <p>That anime episode. That game level. That book chapter. Complete it. Achievement unlocked.</p>
            </div>
          </div>
          
          <div class="menu-item" onclick="trackActivity(this, 'Hangout with Friends')" data-emoji="üë•">
            <span class="check-indicator">‚úì</span>
            <span class="item-emoji">üë•</span>
            <div class="item-content">
              <h3>Hangout with Friends <span class="item-tagline">‚Äî Refuel</span></h3>
              <p>Energy isn't just about doing ‚Äî it's about connecting. Text someone. Make plans. Be human together.</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- DESSERTS -->
    <section class="menu-section desserts" data-section="desserts" data-category="Dessert">
      <div class="section-header" onclick="toggleSection(this)">
        <span class="section-icon">üç∞</span>
        <div class="section-title">
          <h2>Desserts</h2>
          <p>The trap foods ‚Äî delicious, but they steal your day</p>
        </div>
        <span class="chevron">‚ñº</span>
      </div>
      <div class="section-content">
        <div class="items-container">
          <div class="menu-item" onclick="trackActivity(this, 'Social Media Reels')" data-emoji="üì±">
            <span class="check-indicator">‚úì</span>
            <span class="item-emoji">üì±</span>
            <div class="item-content">
              <h3>Social Media Reels <span class="item-tagline">‚Äî The Time Thief</span></h3>
              <p>"Just 5 minutes" becomes 2 hours. You feel hollow after. The algorithm wins.</p>
              <span class="warning">‚ö†Ô∏è Skip it</span>
            </div>
          </div>
          
          <div class="menu-item" onclick="trackActivity(this, 'Chess')" data-emoji="‚ôüÔ∏è">
            <span class="check-indicator">‚úì</span>
            <span class="item-emoji">‚ôüÔ∏è</span>
            <div class="item-content">
              <h3>Chess <span class="item-tagline">‚Äî The Siren</span></h3>
              <p>"One quick game" ‚Äî suddenly it's midnight. Your real work is still waiting.</p>
              <span class="warning">‚ö†Ô∏è Lock the app if you must</span>
            </div>
          </div>
          
          <div class="menu-item" onclick="trackActivity(this, 'Listening to Haram')" data-emoji="üéµ">
            <span class="check-indicator">‚úì</span>
            <span class="item-emoji">üéµ</span>
            <div class="item-content">
              <h3>Listening to Haram <span class="item-tagline">‚Äî The Guilt Loop</span></h3>
              <p>You know how this ends. Temporary pleasure, lasting regret.</p>
              <span class="warning">‚ö†Ô∏è Protect your peace</span>
            </div>
          </div>
          
          <div class="menu-item" onclick="trackActivity(this, 'Unhealthy Eating')" data-emoji="üçî">
            <span class="check-indicator">‚úì</span>
            <span class="item-emoji">üçî</span>
            <div class="item-content">
              <h3>Unhealthy Eating <span class="item-tagline">‚Äî The Crash</span></h3>
              <p>10 minutes of taste, hours of sluggishness. Days of regret.</p>
              <span class="warning">‚ö†Ô∏è Your body is a long-term investment</span>
            </div>
          </div>
          
          <div class="menu-item" onclick="trackActivity(this, 'YouTube Rabbit Holes')" data-emoji="üì∫">
            <span class="check-indicator">‚úì</span>
            <span class="item-emoji">üì∫</span>
            <div class="item-content">
              <h3>YouTube Rabbit Holes <span class="item-tagline">‚Äî The Void</span></h3>
              <p>"How did I get here?" 47 videos later, you know everything about submarine history and nothing about your goals.</p>
              <span class="warning">‚ö†Ô∏è Close the tab</span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- CHEF'S SPECIALS -->
    <section class="menu-section specials" data-section="specials" data-category="Special">
      <div class="section-header" onclick="toggleSection(this)">
        <span class="section-icon">üåü</span>
        <div class="section-title">
          <h2>Chef's Specials</h2>
          <p>Not for everyday ‚Äî but when you need the fire</p>
        </div>
        <span class="chevron">‚ñº</span>
      </div>
      <div class="section-content">
        <div class="items-container">
          <div class="menu-item" onclick="trackActivity(this, 'Go to the Gym')" data-emoji="üí™">
            <span class="check-indicator">‚úì</span>
            <span class="item-emoji">üí™</span>
            <div class="item-content">
              <h3>Go to the Gym <span class="item-tagline">‚Äî The Commitment</span></h3>
              <p>2 hours. Intensity. Sweat. You won't want to go. You'll be glad you did. <strong style="color: var(--gold);">This is the difference between average and alive.</strong></p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- RESCUE MODE -->
    <section class="menu-section rescue" data-section="rescue" data-category="Rescue">
      <div class="section-header" onclick="toggleSection(this)">
        <span class="section-icon">üö®</span>
        <div class="section-title">
          <h2>Rescue Mode</h2>
          <p>When nothing else works ‚Äî nuclear options</p>
        </div>
        <span class="chevron">‚ñº</span>
      </div>
      <div class="section-content">
        <div class="items-container">
          <div class="menu-item" onclick="trackActivity(this, 'Phone in Another Room')" data-emoji="üõ°Ô∏è">
            <span class="check-indicator">‚úì</span>
            <span class="item-emoji">üõ°Ô∏è</span>
            <div class="item-content">
              <h3>Phone in Another Room</h3>
              <p>Can't stop scrolling? Remove the temptation.</p>
            </div>
          </div>
          
          <div class="menu-item" onclick="trackActivity(this, 'Leave the House')" data-emoji="üö™">
            <span class="check-indicator">‚úì</span>
            <span class="item-emoji">üö™</span>
            <div class="item-content">
              <h3>Leave the House</h3>
              <p>Cabin fever? Change your environment immediately.</p>
            </div>
          </div>
          
          <div class="menu-item" onclick="trackActivity(this, 'Text a Friend')" data-emoji="üì±">
            <span class="check-indicator">‚úì</span>
            <span class="item-emoji">üì±</span>
            <div class="item-content">
              <h3>Text a Friend</h3>
              <p>Need pressure? "Hold me accountable." Say it. Mean it.</p>
            </div>
          </div>
          
          <div class="menu-item" onclick="trackActivity(this, '5-Minute Timer')" data-emoji="‚è±Ô∏è">
            <span class="check-indicator">‚úì</span>
            <span class="item-emoji">‚è±Ô∏è</span>
            <div class="item-content">
              <h3>5-Minute Timer</h3>
              <p>Paralyzed? Pick ANY appetizer. Timer starts now. Go.</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <footer>
      <p class="footer-quote">"Pick anything. The goal isn't perfection ‚Äî it's movement."</p>
      <p>Last updated: February 2026</p>
    </footer>
  </div>

  <script>
    // GitHub Configuration
    const DEFAULT_OWNER = 'omarclaw1420';
    const DEFAULT_REPO = 'recovery-kitchen';
    const FILE_PATH = 'data/menu-log.json';
    const BRANCH = 'main';
    const TOKEN_KEY = 'github_pat';
    const TOKEN_SOURCE_KEY = 'github_pat_source';
    
    // ============================================
    // URL TOKEN HANDLING
    // ============================================
    
    /**
     * Extracts a query parameter value from the current URL
     */
    function getUrlParameter(paramName) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(paramName);
    }
    
    /**
     * Validates GitHub token format (basic check)
     */
    function isValidTokenFormat(token) {
      return token && typeof token === 'string' && token.startsWith('ghp_');
    }
    
    /**
     * Saves token to localStorage
     */
    function saveTokenToStorage(token, source = 'manual') {
      if (!isValidTokenFormat(token)) {
        console.error('Invalid token format - must start with ghp_');
        return false;
      }
      localStorage.setItem(TOKEN_KEY, token);
      localStorage.setItem(TOKEN_SOURCE_KEY, source);
      console.log(`Token saved from ${source}`);
      return true;
    }
    
    /**
     * Retrieves the stored token
     */
    function getStoredToken() {
      return localStorage.getItem(TOKEN_KEY);
    }
    
    /**
     * Gets the token source (url, storage, manual)
     */
    function getTokenSource() {
      return localStorage.getItem(TOKEN_SOURCE_KEY) || 'unknown';
    }
    
    /**
     * Clears the stored token
     */
    function clearStoredToken() {
      localStorage.removeItem(TOKEN_KEY);
      localStorage.removeItem(TOKEN_SOURCE_KEY);
    }
    
    /**
     * Removes the token from the URL for cleaner UX
     * Note: Original URL with token is still in browser history
     */
    function cleanUrl() {
      const url = new URL(window.location.href);
      const hadToken = url.searchParams.has('token');
      url.searchParams.delete('token');
      window.history.replaceState({}, document.title, url.toString());
      return hadToken;
    }
    
    /**
     * Initialize token handling on page load
     * Priority: URL token > stored token > show setup
     */
    function initializeToken() {
      // Check URL for token parameter
      const urlToken = getUrlParameter('token');
      
      if (urlToken && isValidTokenFormat(urlToken)) {
        // New token provided via URL - save it
        const saved = saveTokenToStorage(urlToken, 'url');
        if (saved) {
          // Remove token from URL for cleaner look
          cleanUrl();
          showToast('Token loaded from URL and saved', 'success');
        }
        return { token: urlToken, source: 'url' };
      }
      
      // No token in URL - check localStorage
      const storedToken = getStoredToken();
      
      if (storedToken && isValidTokenFormat(storedToken)) {
        console.log('Using token from localStorage');
        return { token: storedToken, source: 'storage' };
      }
      
      // No token found anywhere
      console.log('No token found - setup required');
      return { token: null, source: null };
    }
    
    /**
     * Shows the setup modal when no token exists
     */
    function showSetupRequired() {
      document.getElementById('setupOverlay').classList.remove('hidden');
      document.getElementById('appContainer').style.filter = 'blur(5px)';
    }
    
    /**
     * Hides the setup modal
     */
    function hideSetupRequired() {
      document.getElementById('setupOverlay').classList.add('hidden');
      document.getElementById('appContainer').style.filter = 'none';
    }
    
    /**
     * Saves token from the setup modal
     */
    function saveTokenFromSetup() {
      const token = document.getElementById('setupTokenInput').value.trim();
      
      if (!token) {
        showToast('Please enter a token', 'error');
        return;
      }
      
      if (!isValidTokenFormat(token)) {
        showToast('Invalid token format - must start with ghp_', 'error');
        return;
      }
      
      saveTokenToStorage(token, 'manual');
      document.getElementById('githubToken').value = token;
      updateTokenSourceBadge('manual');
      hideSetupRequired();
      showToast('Token saved! You can now track activities.', 'success');
      updateBookmarkHelp(token);
    }
    
    /**
     * Updates the token source badge in the config section
     */
    function updateTokenSourceBadge(source) {
      const badge = document.getElementById('tokenSourceBadge');
      if (!source) {
        badge.innerHTML = '';
        return;
      }
      
      const labels = {
        'url': { text: '‚úÖ Token loaded from URL', class: 'url' },
        'storage': { text: 'üì¶ Token from storage', class: 'storage' },
        'manual': { text: '‚úèÔ∏è Token entered manually', class: 'manual' }
      };
      
      const config = labels[source] || labels['manual'];
      badge.innerHTML = `<div class="token-source-badge ${config.class}">${config.text}</div>`;
    }
    
    /**
     * Updates the bookmark help section with example URL
     */
    function updateBookmarkHelp(token) {
      if (!token) return;
      
      const helpSection = document.getElementById('urlBookmarkHelp');
      const exampleCode = document.getElementById('bookmarkUrlExample');
      
      // Mask most of the token for display
      const maskedToken = token.substring(0, 8) + '...' + token.substring(token.length - 4);
      const exampleUrl = `https://omarclaw1420.github.io/recovery-kitchen/?token=${maskedToken}`;
      
      exampleCode.textContent = exampleUrl;
      helpSection.style.display = 'block';
    }
    
    // ============================================
    // APP INITIALIZATION
    // ============================================
    
    // Load saved config on startup
    document.addEventListener('DOMContentLoaded', () => {
      // Initialize token from URL or storage
      const { token, source } = initializeToken();
      
      // Load other saved config
      const savedOwner = localStorage.getItem('repo_owner');
      const savedRepo = localStorage.getItem('repo_name');
      
      if (token) {
        document.getElementById('githubToken').value = token;
        updateTokenSourceBadge(source);
        updateBookmarkHelp(token);
        
        // Show appropriate message based on source
        if (source === 'storage') {
          showToast('Token loaded from local storage', 'success');
        }
      } else {
        // No token - show setup modal
        showSetupRequired();
      }
      
      if (savedOwner) {
        document.getElementById('repoOwner').value = savedOwner;
      }
      if (savedRepo) {
        document.getElementById('repoName').value = savedRepo;
      }
      
      updateProgress();
      
      // Try to sync queued entries on page load
      retryQueuedEntries();
    });
    
    // ============================================
    // CONFIGURATION HANDLING
    // ============================================
    
    // Save config to localStorage
    function saveToken() {
      const token = document.getElementById('githubToken').value.trim();
      const owner = document.getElementById('repoOwner').value.trim();
      const repo = document.getElementById('repoName').value.trim();
      
      if (token) {
        const currentStored = getStoredToken();
        if (token !== currentStored) {
          saveTokenToStorage(token, 'manual');
          updateTokenSourceBadge('manual');
          updateBookmarkHelp(token);
        }
      } else {
        clearStoredToken();
        updateTokenSourceBadge(null);
        document.getElementById('urlBookmarkHelp').style.display = 'none';
      }
      
      if (owner) {
        localStorage.setItem('repo_owner', owner);
      } else {
        localStorage.removeItem('repo_owner');
      }
      
      if (repo) {
        localStorage.setItem('repo_name', repo);
      } else {
        localStorage.removeItem('repo_name');
      }
    }
    
    // Get config values
    function getConfig() {
      return {
        token: getStoredToken(),
        owner: localStorage.getItem('repo_owner') || DEFAULT_OWNER,
        repo: localStorage.getItem('repo_name') || DEFAULT_REPO
      };
    }
    
    // ============================================
    // UI HELPERS
    // ============================================
    
    // Show toast notification
    function showToast(message, type = 'info') {
      const container = document.getElementById('toastContainer');
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      
      const icon = type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ÑπÔ∏è';
      toast.innerHTML = `${icon} ${message}`;
      
      container.appendChild(toast);
      
      setTimeout(() => {
        toast.style.opacity = '0';
        toast.style.transform = 'translateY(10px)';
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }
    
    // Show config status
    function showStatus(message, type) {
      const status = document.getElementById('configStatus');
      status.textContent = message;
      status.className = 'config-status show ' + type;
      if (type === 'success') {
        setTimeout(() => {
          status.classList.remove('show');
        }, 3000);
      }
    }
    
    // Toggle section collapse
    function toggleSection(header) {
      const section = header.parentElement;
      section.classList.toggle('expanded');
    }
    
    // ============================================
    // GITHUB API
    // ============================================
    
    // Append entry to JSON file in GitHub repo
    async function appendToJsonFile(newEntry) {
      const { token, owner, repo } = getConfig();
      
      if (!token) {
        throw new Error('No GitHub token configured');
      }
      
      const apiUrl = `https://api.github.com/repos/${owner}/${repo}/contents/${FILE_PATH}`;
      
      // Step 1: Fetch existing file
      let entries = [];
      let sha = null;
      
      try {
        const getResponse = await fetch(apiUrl, {
          headers: {
            'Authorization': `Bearer ${token}`,
            'Accept': 'application/vnd.github.v3+json'
          }
        });
        
        if (getResponse.status === 200) {
          const fileData = await getResponse.json();
          sha = fileData.sha;
          const content = atob(fileData.content);
          entries = JSON.parse(content);
          if (!Array.isArray(entries)) {
            entries = [];
          }
        } else if (getResponse.status === 404) {
          // File doesn't exist yet, start with empty array
          entries = [];
        } else {
          const error = await getResponse.json();
          throw new Error(error.message || `Failed to fetch file: ${getResponse.status}`);
        }
      } catch (error) {
        if (error.message.includes('404')) {
          // File doesn't exist, start fresh
          entries = [];
        } else {
          throw error;
        }
      }
      
      // Step 2: Append new entry
      entries.push(newEntry);
      
      // Step 3: Commit updated file
      const updateBody = {
        message: `Add menu pick: ${newEntry.activity} [${newEntry.category}]`,
        content: btoa(JSON.stringify(entries, null, 2)),
        branch: BRANCH
      };
      
      if (sha) {
        updateBody.sha = sha;
      }
      
      const putResponse = await fetch(apiUrl, {
        method: 'PUT',
        headers: {
          'Authorization': `Bearer ${token}`,
          'Accept': 'application/vnd.github.v3+json',
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(updateBody)
      });
      
      if (!putResponse.ok) {
        const error = await putResponse.json();
        
        // Handle 401 - token invalid
        if (putResponse.status === 401) {
          clearStoredToken();
          showSetupRequired();
          throw new Error('Invalid token - please re-authenticate. Your token may have expired or been revoked.');
        }
        
        throw new Error(error.message || `Failed to commit: ${putResponse.status}`);
      }
      
      return await putResponse.json();
    }
    
    // Track activity when menu item is clicked
    async function trackActivity(item, activityName) {
      const { token } = getConfig();
      const section = item.closest('.menu-section');
      const category = section.dataset.category || 'Unknown';
      
      // Toggle visual selection
      item.classList.toggle('selected');
      updateProgress();
      
      // If no token, just do local tracking
      if (!token) {
        showToast('Activity selected locally (no GitHub token)', 'info');
        showSetupRequired();
        return;
      }
      
      // Prevent double-clicks while sending
      if (item.classList.contains('sending')) {
        return;
      }
      
      // Only track to GitHub when selecting (not deselecting)
      if (!item.classList.contains('selected')) {
        return;
      }
      
      // Mark as sending
      item.classList.add('sending');
      
      // Create entry
      const now = new Date();
      const entry = {
        activity: activityName,
        category: category,
        timestamp: now.toISOString(),
        localTime: now.toLocaleString('en-US', {
          year: 'numeric',
          month: '2-digit',
          day: '2-digit',
          hour: '2-digit',
          minute: '2-digit',
          second: '2-digit',
          timeZoneName: 'short'
        })
      };
      
      try {
        await appendToJsonFile(entry);
        
        // Mark as tracked
        item.classList.remove('sending');
        item.classList.add('tracked');
        showToast(`Tracked: ${activityName}`, 'success');
        
      } catch (error) {
        item.classList.remove('sending');
        console.error('Failed to log menu pick:', error);
        showToast(`Failed: ${error.message}`, 'error');
        
        // Queue for retry (stored in localStorage)
        queueForRetry(entry);
      }
    }
    
    // Queue entry for retry
    function queueForRetry(entry) {
      const queue = JSON.parse(localStorage.getItem('menu-queue') || '[]');
      queue.push({ ...entry, queuedAt: new Date().toISOString() });
      localStorage.setItem('menu-queue', JSON.stringify(queue));
      showToast('Saved locally, will retry later', 'info');
    }
    
    // Retry queued entries
    async function retryQueuedEntries() {
      const queue = JSON.parse(localStorage.getItem('menu-queue') || '[]');
      if (queue.length === 0) return;
      
      const { token } = getConfig();
      if (!token) return;
      
      const newQueue = [];
      let successCount = 0;
      
      for (const entry of queue) {
        try {
          await appendToJsonFile(entry);
          successCount++;
        } catch (error) {
          newQueue.push(entry);
        }
      }
      
      localStorage.setItem('menu-queue', JSON.stringify(newQueue));
      
      if (successCount > 0) {
        showToast(`Synced ${successCount} queued entries`, 'success');
      }
    }
    
    // Update progress bar
    function updateProgress() {
      const total = document.querySelectorAll('.menu-item').length;
      const selected = document.querySelectorAll('.menu-item.selected').length;
      const percentage = (selected / total) * 100;
      document.getElementById('progressBar').style.width = percentage + '%';
    }
    
    // ============================================
    // RANDOM PICKER
    // ============================================
    
    const allItems = [
      { emoji: 'üö∂', title: 'Small Walk', desc: 'Step outside. No destination needed. 5 minutes of fresh air untangles your brain.', section: 'appetizers', category: 'Appetizer' },
      { emoji: 'üßπ', title: 'Organize Your Lab', desc: 'Move one thing to its place. Just one. Suddenly the chaos feels beatable.', section: 'appetizers', category: 'Appetizer' },
      { emoji: '‚òï', title: 'Morning Milk / Evening Tea', desc: 'Warmth in a cup. Morning = fuel. Night = wind-down. Either way, you\'re caring for yourself.', section: 'appetizers', category: 'Appetizer' },
      { emoji: 'ü§∏', title: 'Morning Exercises', desc: '10 jumping jacks. A stretch. Your blood remembers how to move ‚Äî remind it.', section: 'appetizers', category: 'Appetizer' },
      { emoji: 'üöø', title: 'Quick Shower', desc: 'Water washes away more than dirt. Step in stale, step out new.', section: 'appetizers', category: 'Appetizer' },
      { emoji: 'üõèÔ∏è', title: 'Make Your Bed', desc: 'The room instantly looks 40% better. You\'ve already won today.', section: 'appetizers', category: 'Appetizer' },
      { emoji: 'üõ†Ô∏è', title: 'Work on a Project', desc: 'That thing you keep thinking about? 30 minutes on it. Future-you will be grateful.', section: 'mains', category: 'Main' },
      { emoji: 'üìö', title: 'Learn Something New', desc: 'A chapter. A tutorial. A video that teaches instead of entertains. You grow when you learn.', section: 'mains', category: 'Main' },
      { emoji: '‚úÖ', title: 'Crush Pending Chores', desc: 'That list weighing on you? Pick three. Do them. The relief is instant.', section: 'mains', category: 'Main' },
      { emoji: 'üèÜ', title: 'Finish Something', desc: 'That anime episode. That game level. That book chapter. Complete it. Achievement unlocked.', section: 'mains', category: 'Main' },
      { emoji: 'üë•', title: 'Hangout with Friends', desc: 'Energy isn\'t just about doing ‚Äî it\'s about connecting. Text someone. Make plans.', section: 'mains', category: 'Main' },
      { emoji: 'üí™', title: 'Go to the Gym', desc: '2 hours. Intensity. Sweat. You won\'t want to go. You\'ll be glad you did.', section: 'specials', category: 'Special' }
    ];
    
    function pickRandom() {
      const resultCard = document.getElementById('resultCard');
      const resultEmoji = document.getElementById('resultEmoji');
      const resultTitle = document.getElementById('resultTitle');
      const resultDesc = document.getElementById('resultDesc');
      
      let selectedItem = null;
      
      // Animation effect
      let count = 0;
      const interval = setInterval(() => {
        selectedItem = allItems[Math.floor(Math.random() * allItems.length)];
        resultEmoji.textContent = selectedItem.emoji;
        resultTitle.textContent = selectedItem.title;
        count++;
        if (count > 10) {
          clearInterval(interval);
          resultDesc.textContent = selectedItem.desc;
          resultCard.classList.add('show');
          
          // Scroll to result
          resultCard.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
          
          // Auto-track the random pick
          setTimeout(() => {
            trackRandomPick(selectedItem);
          }, 500);
        }
      }, 100);
    }
    
    async function trackRandomPick(item) {
      const { token } = getConfig();
      if (!token) {
        showToast('Set up GitHub token to track activities', 'info');
        return;
      }
      
      const now = new Date();
      const entry = {
        activity: item.title,
        category: item.category,
        timestamp: now.toISOString(),
        localTime: now.toLocaleString('en-US', {
          year: 'numeric',
          month: '2-digit',
          day: '2-digit',
          hour: '2-digit',
          minute: '2-digit',
          second: '2-digit',
          timeZoneName: 'short'
        }),
        source: 'random-picker'
      };
      
      try {
        await appendToJsonFile(entry);
        showToast(`Tracked: ${item.title}`, 'success');
      } catch (error) {
        console.error('Failed to track random pick:', error);
        showToast(`Failed to track: ${error.message}`, 'error');
        queueForRetry(entry);
      }
    }
  </script>
</body>
</html>